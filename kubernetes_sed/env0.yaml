version: 2

deploy:
  steps:
    setupVariables:
      after:
        - name: Check kubeconfig
          run: | 
            ls -la ~/.kube
            echo $KUBECONFIG
    k8sDiff: &k8s
      before:
        - name: Check kubeconfig
          run: | 
            ls -la ~/.kube
            echo $KUBECONFIG
        - name: Run kubectl
          run: |
            kubectl get ns
        - name: Replace Namespace
          run: |
            sed -i "s/{{namespace-name}}/$NAMESPACE/g" namespace.yaml
destroy:
  steps:
    k8sDiff: *k8s